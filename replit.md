# Aside - Personal Information Management System

### Overview
Aside is an SMS management platform designed for persistent message storage and seamless communication across multiple devices. Its core purpose is to intelligently organize messages and provide advanced integration capabilities, including rich social media embeds, real-time shared boards, and an AI-powered hybrid categorization system. The business vision is to provide a user-friendly, SMS-first solution for saving and organizing information from anywhere, accessible via a web dashboard at textaside.app, with ambitions to expand AI-driven personalization and content understanding.

### User Preferences
- **Design**: #b95827 primary color (orange), #263d57 secondary (dark blue), #fff2ea background, Aside branding, mobile-responsive
- **Layout**: Logo in sidebar (far left), search bar and logout button positioned directly under shared boards section within scrollable area
- **Functionality**: No message input form - messages only via SMS webhooks
- **Storage**: Persistent PostgreSQL database for message retention
- **Integration**: Twilio for reliable SMS webhook handling

### System Architecture
The system utilizes a modern web architecture with a TypeScript React frontend (Vite) and a Node.js Express backend. Data persistence is managed by a PostgreSQL database with Drizzle ORM and pgvector for semantic search. Real-time features are powered by WebSockets. The platform integrates with Twilio for SMS processing, supporting incoming messages via webhooks and outgoing notifications. Key architectural decisions include an "SMS-first" onboarding flow and a content-aware conversational AI that analyzes saved messages. UI/UX design emphasizes a clean, mobile-optimized experience with a warm color scheme and consistent branding. Features include multi-user authentication with phone number verification and magic link tokens, user-scoped message storage, smart hashtag inheritance, comprehensive social media and general URL link previews (Instagram, Pinterest, X/Twitter via official widget embeds, Reddit, Facebook, YouTube, TikTok, IMDB), shared board functionality with real-time notifications, and message editing/renaming. An admin dashboard provides management capabilities. The system also includes a Squarespace integration API for professional website signups with instant SMS welcome messages. AI integration includes: (1) "Hey Aside" conversational AI trigger for explicit AI queries via SMS using OpenAI GPT-4o-mini for intent classification (search, summarize, recommend, analyze, login), (2) OpenAI text-embedding-3-small for vector embeddings and hybrid search (70% semantic + 30% keyword), and (3) DeepSeek for hybrid categorization and daily affirmations. Web dashboard search temporarily disabled pending rebuild.

### External Dependencies
- **Twilio**: For SMS integration, handling incoming webhooks and sending outgoing messages.
- **PostgreSQL with pgvector**: Primary database for persistent storage and vector similarity search.
- **OpenAI**: text-embedding-3-small model for generating 1536-dimensional vector embeddings for semantic search. Also powers "Hey Aside" conversational AI using GPT-4o-mini.
- **DeepSeek AI**: Used for intelligent message categorization and generating personalized daily affirmations.
- **Microlink.io**: Primary service for generating rich link previews and handling bot protection on e-commerce sites.
- **TMDB API**: Integrated for enhanced IMDB link previews.
- **Social Media Platforms (Instagram, Pinterest, X/Twitter, Reddit, Facebook, YouTube, TikTok)**: Integrated for rich iframe embeds and link preview parsing.

### Recent Changes
- **Improved Open Graph cache management for production deployments** (October 2025): Reduced failure cache TTL from 1 hour to 5 minutes to prevent stale failures from persisting across deployments. Added initialization logging to display which Microlink endpoint (pro vs api) is being used on server startup. Enhanced error logging to include full error response text for better debugging. These improvements ensure that production deployments recover quickly from transient API failures and make it easier to diagnose preview issues.
- **Fixed Reddit share URL preview cards** (October 2025): Resolved Microlink.io API endpoint issue preventing Reddit share URLs (/r/subreddit/s/shareId) from generating Open Graph preview cards. Root cause was paid API tier requiring `pro.microlink.io` endpoint instead of `api.microlink.io` when API key is present. Modified og-service.ts to dynamically select correct endpoint based on MICROLINK_API_KEY presence. Reddit share URLs now display properly with Reddit-branded preview cards showing title, description, and image metadata.
- **Added SMS login link requests via "Hey Aside"** (October 2025): Extended "Hey Aside" AI to support login link requests. Users can now text "Hey Aside, how do I login?" or similar queries to receive a secure magic link via SMS. Intent classifier (GPT-4o-mini) detects login intent and generates a time-limited, one-time-use magic link using MagicLinkService. Includes rate limiting (max 5 links per hour) and graceful error handling. Links expire in 30 minutes. Example usage: "Hey Aside, send me a login link" → Returns: "Here's your login link: https://textaside.app/auth/[token]\n\nThis link expires in 30 minutes and can only be used once."
- **Implemented Reddit embed widgets** (October 2025): Added Reddit embed support using Reddit's official embed API. Detects standard Reddit comment URLs (reddit.com and old.reddit.com) and displays rich embedded posts with full content, images, upvotes, comments, and author info. Bypasses generic preview card limitations. Embedded Reddit posts automatically hide the raw URL from message text. Created RedditEmbed component with loading state. Note: Share URLs (/r/subreddit/s/shareId) fall back to Open Graph preview as they use shareIds incompatible with the embed API. Added isRedditUrl() helper to ensure ALL Reddit URLs (including share URLs) hide the raw link when previews load, preventing duplicate URL display.
- **Implemented "Hey Aside" AI trigger for SMS queries** (October 2025): Introduced explicit AI trigger pattern where users start messages with "Hey Aside" followed by their query to activate the conversational AI assistant. System uses OpenAI GPT-4o-mini to classify intent into search, summarize, recommend, analyze, or login. Currently supports intelligent search with hybrid semantic+keyword matching. Replaced complex implicit search detection (question patterns, keyword matching) with clean, unambiguous trigger to eliminate false positives. All old search detection logic removed/commented out. Future expansion planned for summarization, recommendations, and content analysis. Analytics tracked via Pendo (Hey_Aside_Query_Submitted, Hey_Aside_Response_Sent). Example usage: "Hey Aside, find my recipes" → AI performs search and returns formatted results via SMS.
- **Temporarily disabled web dashboard search functionality** (October 2025): Hidden the homescreen search bar and search results display on dashboard due to broken template rendering. All search-related UI and logic (search state, debouncing, hybrid query, analytics) temporarily removed from dashboard.tsx. SMS search functionality remains active via "Hey Aside" trigger. Web search to be rebuilt from ground up in future iteration. Dashboard now displays simple greeting ("Hi [FirstName]") and boards grid only.
- **Implemented Twitter/X embed widgets** (October 2025): Added full Twitter embed support using Twitter's official widget API. Detects both twitter.com and x.com URLs, extracts tweet ID, and displays rich embedded tweets with images, videos, author info, and interactions. Bypasses scraping restrictions that broke link previews. Embedded tweets automatically hide the raw URL from message text. Created TwitterEmbed component with loading state and automatic script injection.
- **Fixed message deletion with embeddings** (October 2025): Added cascade delete to messageEmbeddings foreign key in schema.ts. Messages with vector embeddings can now be deleted successfully without foreign key constraint errors. Pushed schema change to production database via `npm run db:push --force`.